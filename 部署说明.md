# 联通网盘统一服务部署说明

## 📋 系统要求

- Python 3.7+
- 2GB+ 内存
- 网络连接

## 🚀 快速部署

### 1. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt
```

### 2. 配置Token

编辑 `tokens.json` 文件：
```json
{
  "tokens": [
    {
      "token": "你的联通网盘Token",
      "name": "主Token",
      "is_active": true
    }
  ]
}
```

### 3. 启动服务

```bash
# 开发环境
python simple_unified_service.py

# 生产环境（推荐）
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 simple_unified_service:app
```

## 🔐 登录信息

- **用户名**: `admin`
- **密码**: `3150261994`

## 🌐 访问地址

- **管理界面**: http://localhost:8000
- **API服务**: http://localhost:8000/api/

## 📋 主要API端点

### 文件下载
```bash
GET /api/download/?url=文件夹名/文件名
```

### 文件夹列表
```bash
GET /api/folders
```

### 文件列表
```bash
GET /api/files?folder=文件夹名
```

### Token获取
```bash
GET /api/token/get
```

## 🔧 生产环境配置

### 使用Nginx反向代理

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 使用systemd服务

创建 `/etc/systemd/system/wopan-service.service`:

```ini
[Unit]
Description=WoPan Unified Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/path/to/your/app
Environment=PATH=/path/to/your/venv/bin
ExecStart=/path/to/your/venv/bin/gunicorn -w 4 -b 127.0.0.1:8000 simple_unified_service:app
Restart=always

[Install]
WantedBy=multi-user.target
```

启动服务：
```bash
sudo systemctl enable wopan-service
sudo systemctl start wopan-service
```

## 🛡️ 安全建议

1. **修改默认密码**: 在 `simple_unified_service.py` 中修改 `AUTH_CONFIG`
2. **使用HTTPS**: 配置SSL证书
3. **防火墙**: 只开放必要端口
4. **定期更新**: 保持依赖库最新

## 📊 监控和日志

### 查看日志
```bash
# 实时查看日志
tail -f /var/log/wopan-service.log

# 使用journalctl查看systemd日志
sudo journalctl -u wopan-service -f
```

### 性能监控
- CPU使用率
- 内存使用率
- API响应时间
- Token使用统计

## 🔄 更新部署

```bash
# 1. 备份配置
cp tokens.json tokens.json.bak

# 2. 更新代码
git pull  # 或下载新版本

# 3. 更新依赖
pip install -r requirements.txt

# 4. 重启服务
sudo systemctl restart wopan-service
```

## ❓ 常见问题

### Q: Token失效怎么办？
A: 在管理界面添加新的有效Token，删除失效的Token

### Q: API响应慢怎么办？
A: 检查网络连接，考虑增加Worker进程数

### Q: 忘记登录密码？
A: 修改 `simple_unified_service.py` 中的 `AUTH_CONFIG`

### Q: 端口被占用？
A: 修改启动命令中的端口号，如 `-b 0.0.0.0:8001`

## 📞 技术支持

如遇问题，请检查：
1. 日志文件
2. Token有效性
3. 网络连接
4. 依赖库版本
