#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
è”é€šç½‘ç›˜Webç‰ˆå¯åŠ¨è„šæœ¬
"""

import os
import sys
import webbrowser
import time
import threading

def check_dependencies():
    """æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…"""
    try:
        import flask
        import requests
        from Crypto.Cipher import AES
        print("âœ… æ‰€æœ‰ä¾èµ–å·²å®‰è£…")
        return True
    except ImportError as e:
        print(f"âŒ ç¼ºå°‘ä¾èµ–: {e}")
        print("è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–:")
        print("pip install -r requirements.txt")
        return False

def open_browser():
    """å»¶è¿Ÿæ‰“å¼€æµè§ˆå™¨"""
    time.sleep(2)  # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
    webbrowser.open('http://localhost:5000')

def main():
    print("ğŸš€ è”é€šç½‘ç›˜ Web ç‰ˆå¯åŠ¨å™¨")
    print("=" * 50)
    
    # æ£€æŸ¥ä¾èµ–
    if not check_dependencies():
        input("æŒ‰å›è½¦é”®é€€å‡º...")
        return
    
    # å¯¼å…¥å¹¶å¯åŠ¨Flaskåº”ç”¨
    try:
        from wopan_web import app
        
        print("ğŸ“¡ å¯åŠ¨WebæœåŠ¡å™¨...")
        print("ğŸŒ è®¿é—®åœ°å€: http://localhost:5000")
        print("ğŸ’¡ æç¤º: æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨")
        print("=" * 50)
        
        # åœ¨æ–°çº¿ç¨‹ä¸­æ‰“å¼€æµè§ˆå™¨
        browser_thread = threading.Thread(target=open_browser)
        browser_thread.daemon = True
        browser_thread.start()
        
        # å¯åŠ¨Flaskåº”ç”¨
        app.run(
            host='0.0.0.0',
            port=5000,
            debug=False,  # ç”Ÿäº§ç¯å¢ƒå…³é—­è°ƒè¯•æ¨¡å¼
            use_reloader=False  # é¿å…é‡å¤å¯åŠ¨
        )
        
    except KeyboardInterrupt:
        print("\nğŸ‘‹ æœåŠ¡å™¨å·²åœæ­¢")
    except Exception as e:
        print(f"âŒ å¯åŠ¨å¤±è´¥: {e}")
        input("æŒ‰å›è½¦é”®é€€å‡º...")

if __name__ == '__main__':
    main()
